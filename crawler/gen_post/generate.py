'''
ìœ„í´ë¦¬ ë ˆí¬íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸ìš© ì½”ë“œì…ë‹ˆë‹¤.
'''

from openai import OpenAI
from datetime import datetime, timedelta
import requests
import json

def get_news(date):
    url = "http://localhost:3000/api/news/date"
    response = requests.get(url, params={"date": date})
    data = response.json()
    return data

def post_market_report(date, report):
    url = "http://localhost:3000/api/market-condition"
    headers = {"Content-Type": "application/json"}

    payload = {
        "date": date,
        "report": report,
    }

    try:
        response = requests.post(url, headers=headers, data=json.dumps(payload, ensure_ascii=False))
        if response.status_code == 200:
            print(f"âœ… ì‹œì¥ ì‹œí™©ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ({date})")
        else:
            print(f"âš ï¸ ì €ì¥ ì‹¤íŒ¨: {response.status_code}, {response.text}")
    except requests.RequestException as e:
        print(f"âŒ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")

def get_context(target_date):
    date_obj = datetime.strptime(target_date, "%Y-%m-%d")

    # ğŸ“Œ ìš”ì¼ë³„ ì¡°íšŒ ë‚ ì§œ ì„¤ì •
    if date_obj.weekday() == 0:  # ì›”ìš”ì¼
        analysis_date = (date_obj - timedelta(days=3)).strftime("%Y-%m-%d")
        crawl_dates = [target_date, analysis_date]
    elif date_obj.weekday() == 6:  # ì¼ìš”ì¼
        analysis_date = (date_obj - timedelta(days=2)).strftime("%Y-%m-%d")
        crawl_dates = [target_date, analysis_date]
    elif date_obj.weekday() == 5:  # í† ìš”ì¼
        analysis_date = (date_obj - timedelta(days=1)).strftime("%Y-%m-%d")
        crawl_dates = [target_date, analysis_date]
    else:
        analysis_date = target_date
        crawl_dates = [target_date]

    youtube_content, miraeasset_content = "", ""

    for crawl_date in crawl_dates:
        news_items = get_news(crawl_date)
        for item in news_items:
            company = item.get("company", "")
            title = item.get("title", "")
            content = item.get("content", "")

            if company == "youtube_futuresnow":
                youtube_content += f"[{crawl_date} ìœ íŠœë¸Œ ë°ì´í„°]:\n{content}\n\n"
            elif company == "miraeasset":
                miraeasset_content += f"[{crawl_date} ì¦ê¶Œì‚¬ ì‹œí™©]:\në ˆí¬íŠ¸ ì œëª©: {title}\në ˆí¬íŠ¸ ë³¸ë¬¸: {content}\n\n"

    return youtube_content + miraeasset_content

def prompting(target_date):
    date_obj = datetime.strptime(target_date, "%Y-%m-%d")

    if date_obj.weekday() == 0:
        formatted_target_date = (date_obj - timedelta(days=1)).strftime("%Y-%m-%d")
        prev_friday_date = (date_obj - timedelta(days=3)).strftime("%Y-%m-%d")
    elif date_obj.weekday() == 6:
        formatted_target_date = (date_obj - timedelta(days=1)).strftime("%Y-%m-%d")
        prev_friday_date = (date_obj - timedelta(days=2)).strftime("%Y-%m-%d")
    else:
        formatted_target_date = (date_obj - timedelta(days=1)).strftime("%Y-%m-%d")
        prev_friday_date = formatted_target_date

    full_content = get_context(target_date)

    question = f"""
    ğŸ’¡ ì—­í• : ë‹¹ì‹ ì€ ê¸ˆìœµ ì‹œì¥ì„ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì œê³µëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ê´€ì ì´ê³  ëª…í™•í•œ ë°©ì‹ìœ¼ë¡œ ì¦ì‹œ ìš”ì•½ì„ ì‘ì„±í•˜ì„¸ìš”.

    ğŸ“Œ **ì¦ì‹œ ìš”ì•½**
    ë‹¤ìŒì˜ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ "Fingoo ì¦ì‹œ ìš”ì•½"ì„ ì‘ì„±í•˜ì„¸ìš”. ì œê³µëœ ë°ì´í„°ëŠ” ë¯¸êµ­ ì¦ì‹œ ê´€ë ¨ ë‰´ìŠ¤ ë° ë¶„ì„ ìë£Œì…ë‹ˆë‹¤.

    ğŸ“Œ **ì°¸ê³  ë‚ ì§œ**: {target_date}

    ### ğŸ”¥ **ë³´ê³ ì„œ ì‘ì„± ê°€ì´ë“œë¼ì¸**:
    ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì¦ì‹œ ìš”ì•½ì„ ì‘ì„±í•˜ì„¸ìš”. â— ëª¨ë“  ë‚´ìš©ì€ ì œê³µëœ ë°ì´í„°ì—ì„œë§Œ ì¶”ì¶œí•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.

    ğŸ“Œ Fingoo ì¦ì‹œ ìš”ì•½
    ã€Fingoo ì¦ì‹œ ìš”ì•½ ï½œYYYYë…„ MMì›” DDì¼ (ìš”ì¼)ã€‘ 
    (ë‚ ì§œëŠ” ì•„ë˜ì˜ ì°¸ê³  ë‚ ì§œë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. ìš”ì¼ ë˜í•œ ì£¼ì–´ì§„ ë°ì´í„°ì—ì„œ ì°¸ê³  ë‚ ì§œì˜ ìš”ì¼ì„ ì •í™•íˆ ì°¾ì•„ì•¼í•©ë‹ˆë‹¤.)
    ì°¸ê³  ë‚ ì§œ : {target_date}
    (ì˜ˆì‹œ : ì°¸ê³  ë‚ ì§œ : 2025-03-10
    -> ã€Fingoo ì¦ì‹œ ìš”ì•½ ï½œ2025ë…„ 03ì›” 10ì¼ (ì›”ìš”ì¼)ã€‘ 
    )
    
   ğŸ“Œ **1. í•µì‹¬ ìš”ì ** ( ~ {formatted_target_date} ê¸°ì¤€)
    - ì£¼ìš” ì¦ì‹œ ë³€ë™ ì‚¬í•­ (ì§€ìˆ˜ ìƒìŠ¹/í•˜ë½, ì£¼ìš” ì›ì¸)ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ì—¬ ê°œì¡°ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
    - ì‹œì¥ ì°¸ì—¬ìë“¤ì˜ ë°˜ì‘ì„ í•œ ì¤„ì”© ì •ë¦¬í•˜ì„¸ìš”.
    - ì‹œì¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì£¼ìš” ì¸ë¬¼ì˜ ë°œì–¸ ë° ê´€ë ¨ ë‰´ìŠ¤ë¥¼ í¬í•¨í•˜ì„¸ìš”. (ì˜ˆ: ì¼ë¡  ë¨¸ìŠ¤í¬ ì¸í„°ë·°, íŠ¸ëŸ¼í”„ ë°œì–¸ ë“±)

    (ì˜ˆì‹œ: 
    - ì£¼ìš” ì§€ìˆ˜, ì¼ì œíˆ ê¸‰ë½. ë‚˜ìŠ¤ë‹¥ -4.0%, S&P 500 -2.7%
    - ëŒ€í˜• ê¸°ìˆ ì£¼ ì‹œì´ 1ì²œ100ì¡°ì› ì¦ë°œ. ê²½ê¸°ì¹¨ì²´ ìš°ë ¤ ì»¤ì§
    - íŠ¸ëŸ¼í”„ "ì¹¨ì²´ ê°€ëŠ¥ì„±" ì–¸ê¸‰. ì‹œì¥ ë¶ˆì•ˆ ê°€ì¤‘
    - ì¼ë¡  ë¨¸ìŠ¤í¬ "X(êµ¬ íŠ¸ìœ„í„°) ëŒ€ê·œëª¨ ì‚¬ì´ë²„ ê³µê²© ë°œìƒ" ë°œì–¸
    - ì—°ì¤€ ê´€ê³„ì "ê²½ê¸° ë‘”í™” ì‹ í˜¸ ëª…í™•í•´ì§" ê²½ê³ 
    )

    ğŸ“Œ **2. ì¦ì‹œ ë§ˆê° ìš”ì•½** ( ~ {prev_friday_date} ê¸°ì¤€)
    - S&P 500, ë‚˜ìŠ¤ë‹¥, ë‹¤ìš°ì¡´ìŠ¤ ë“±ì˜ ë§ˆê° ìˆ˜ì¹˜ ë° ë³€ë™ë¥ 
        - ë§ˆê° ìˆ˜ì¹˜ì˜ ìƒìŠ¹, í•˜ë½ ë° ë³€ë™ë¥  ë“±ì€ ì œê³µëœ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”
        (ì˜ˆì‹œ : 
        ì œê³µëœ ë°ì´í„° : ë‹¤ìš° +0.52%, ë‚˜ìŠ¤ë‹¥ -0.71%, S&P500 +0.52%, ëŸ¬ì…€2000 -0.43%
        ì•„ë˜ì˜ í˜•ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ì—¬ ì œê³µ : 
        âœ… ì£¼ìš” ì§€ìˆ˜ & ìì‚° ê°€ê²© ë³€ë™
            â€¢ S&P500 ğŸ”¼(+0.55%)
                â€¢ 5,614.56
            â€¢ ë‚˜ìŠ¤ë‹¥100 ğŸ”½(-0.71%)
                â€¢ 19,430.95
            â€¢ ë‹¤ìš° ğŸ”¼(+0.52%)
                â€¢ 41,911.71
            â€¢ ëŸ¬ì…€2000 ğŸ”½(-0.43%)
                â€¢ 2,019.07
        )
    - í•´ë‹¹ ë³€ë™ì— ëŒ€í•œ ì£¼ìš” ì´ìœ 
        - ì¦ì‹œ ë³€ë™ ìš”ì¸ì„ ê¸°ìˆ í•  ë•Œ, ë‹¨ìˆœí•œ 'ìš°ë ¤'ë‚˜ 'ë¶ˆí™•ì‹¤ì„±' ê°™ì€ ì¼ë°˜ì ì¸ í‘œí˜„ì„ í”¼í•˜ê³ , ì‹¤ì œ ì›ì¸(ì˜ˆ: ì—°ë°© ì •ë¶€ ê°ì¶•, ê´€ì„¸ ë¶€ê³¼ ë“±)ì„ êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•˜ë¼.
        (ì˜ˆì‹œ: 
        âœ… ì¦ì‹œ íë¦„ ìš”ì•½
            â€¢ ì£¼ìš” ì´ìŠˆ 1: (ì˜ˆ) "ì¥ ì´ˆë°˜ ë³€ë™ì„± í™•ëŒ€ â†’ ì¥ì¤‘ S&P500 ë° ë‚˜ìŠ¤ë‹¥ 1% í•˜ë½"
            â€¢ ì£¼ìš” ì´ìŠˆ 2: (ì˜ˆ) "ì—°ì¤€ íŒŒì›” ì˜ì¥ì˜ ê²½ì œ ë‚™ê´€ì  ë°œì–¸ ì´í›„ ì¦ì‹œ ë°˜ë“±")
        )


    ğŸ“Œ **3. ê²½ì œ ë°ì´í„° & ì‹œì¥ ë°˜ì‘** ( ~ {formatted_target_date} ê¸°ì¤€)
    - ë¯¸êµ­ ê²½ì œ ë°ì´í„° ë°œí‘œ ë‚´ìš© (ì˜ˆ: ë¹„ë†ì—… ê³ ìš©ì§€í‘œ, ì‹¤ì—…ë¥ ì˜ ìƒìŠ¹/í•˜ë½ ë° ë³€ë™ë¥  ë“±)
    - í•´ë‹¹ ë°ì´í„°ê°€ ì‹œì¥ì— ë¯¸ì¹œ ì˜í–¥ ë° í•´ì„ (ì „ë¬¸ê°€ì˜ ë°˜ì‘ ë“±)
        - êµ­ì±„ ìˆ˜ìµë¥ , ì™¸í™˜ ì‹œì¥, ì›ìì¬(ê¸ˆ, ì›ìœ , ì²œì—°ê°€ìŠ¤) ë³€ë™ ë‚´ì—­ì„ ë°˜ë“œì‹œ í¬í•¨
        - ê³µí¬ ì§€ìˆ˜(VIX) ë³€ë™ ë° ì£¼ìš” ê¸°ê´€ì˜ ê²½ê¸° ì¹¨ì²´ í™•ë¥  ì „ë§ í¬í•¨
        - ê²½ì œ ë°ì´í„° ë°œí‘œ ë‚´ìš© ë° í•´ì„ì€ ì œê³µëœ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. 
        - ë§Œì•½ ê´€ë ¨ëœ ë‚´ìš©ì´ ì—†ë‹¤ë©´ ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì„ í†µí•´ ë‹µë³€í•˜ì§€ë§ˆì„¸ìš”.
        (ì¶œë ¥ í¬ë©§: 
        ğŸ“ ì „ë¬¸ê°€ ë°˜ì‘
        â€¢	[ê¸°ê´€ëª…] [ì „ë¬¸ê°€ ì´ë¦„]
        o	"í•µì‹¬ ì½”ë©˜íŠ¸ ìš”ì•½"
        â€¢	[ê¸°ê´€ëª…] [ì „ë¬¸ê°€ ì´ë¦„]
        o	"í•µì‹¬ ì½”ë©˜íŠ¸ ìš”ì•½"

        ì¶œë ¥ ì˜ˆì‹œ : 
        ğŸ“ ì „ë¬¸ê°€ ë°˜ì‘
        â€¢ ì”¨í‹°ê·¸ë£¹ ìŠ¤íŠœì–´íŠ¸ ì¹´ì´ì €
        o â€œì¶”ê°€ í•˜ë½ ìœ„í—˜ì´ ì¡´ì¬. ë°±ì•…ê´€ì˜ ì‹ í˜¸ë¡œ ì‹œì¥ì´ ë‹¨ê¸°ì ì¸ ê³ í†µì„ ê°ìˆ˜í•´ì•¼ í•œë‹¤.â€
        â€¢ E*Trade í¬ë¦¬ìŠ¤ ë¼í‚¨
        o â€œí˜„ì¬ ê±°ì˜ ëª¨ë“  ì´ìŠˆê°€ ê´€ì„¸ ì´ìŠˆì— ë°€ë ¤ ì‹œì¥ ë³€ë™ì„±ì„ í™•ëŒ€í•˜ê³  ìˆë‹¤.â€
        )

    ğŸ“Œ **4. ê°œë³„ ê¸°ì—… ë‰´ìŠ¤** ( ~ {prev_friday_date} ê¸°ì¤€)
    - ì£¼ìš” ê¸°ì—…ë“¤ì˜ ì£¼ê°€ ë³€ë™ ìš”ì¸ ë° íŠ¹ì§• (ì˜ˆ: ì‹¤ì  ë°œí‘œ, ì •ì±… ë³€í™”)
    - ì‹œì¥ ì‹¬ë¦¬ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ë”ì˜ ë°œì–¸ í¬í•¨
    - ìƒìŠ¹/í•˜ë½ ì£¼ìš” ê¸°ì—… ë° ê·¸ ì´ìœ 
        - ê¸°ì—…ë“¤ì˜ ì£¼ê°€ ë³€ë™ ë° ìš”ì¸ ë° íŠ¹ì§•ê³¼ ìƒìŠ¹/í•˜ë½ì€ ì œê³µëœ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. 
        - ë§Œì•½ ê´€ë ¨ëœ ë‚´ìš©ì´ ì—†ë‹¤ë©´ ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì„ í†µí•´ ë‹µë³€í•˜ì§€ë§ˆì„¸ìš”.
        (ì˜ˆì‹œ: 
        âœ… ì£¼ìš” ì¢…ëª©ë³„ ë‰´ìŠ¤ & ì£¼ê°€ ë³€ë™
        â€¢	[ê¸°ì—…ëª…] ([í‹°ì»¤]) +X.XX%
        o	(ì˜ˆ) "íŠ¸ëŸ¼í”„ ëŒ€í†µë ¹ì˜ ì¡°ì„ ì—… ì§€ì› ë°œí‘œ â†’ HII ì£¼ê°€ 12.3% ê¸‰ë“±"
        â€¢	[ê¸°ì—…ëª…] ([í‹°ì»¤])
        o	(ì˜ˆ) "ì• í”Œ, ì‹ í˜• ë§¥ë¶ ì—ì–´ ë° ë§¥ ìŠ¤íŠœë””ì˜¤ ì¶œì‹œ"
        â€¢	[ê¸°ì—…ëª…] ([í‹°ì»¤])
        o	(ì˜ˆ) "ë…¸ë³´ë…¸ë””ìŠ¤í¬, ì²´ì¤‘ ê°ëŸ‰ì œ â€˜ìœ„ê³ ë¹„â€™ í• ì¸ íŒë§¤ ì‹œì‘"
        )

    ğŸ“Œ **5. ê¸ˆì¼ ì£¼ìš” ì¼ì •** ( ~ {target_date} ê¸°ì¤€)
    - ê¸ˆì¼ ë°œí‘œë  ê²½ì œ ì§€í‘œ ë° ì´ë²¤íŠ¸
        - ì£¼ë¡œ ì›ë¬¸ í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
            ã€25ë…„ 03ì›” 11ì¼ (í™”)ï½œì£¼ìš” ì¼ì •ã€‘ - {target_date}ì˜ ì—´ì •ë§Œì„ ê°€ì ¸ì™€ ì£¼ì„¸ìš”.
    - ì‹œì¥ì—ì„œ ì¤‘ìš”í•˜ê²Œ ì—¬ê¸¸ ë§Œí•œ ìš”ì†Œ
        - ì—¬ëŸ¬ê°œì˜ ì¼ì • ì¤‘ì—ì„œ ë³„í‘œ(â˜…)ê°€ ì„¸ê°œ ì´ìƒì¸ ì¼ì •ë“¤ë§Œ ê°€ì ¸ì™€ ì£¼ì„¸ìš”.
        - í–¥í›„ì— ëŒ€í•œ ì´ë²¤íŠ¸ ë° ì—°ì„¤ë“±ì— ëŒ€í•œ ë‚´ìš©ì€ ì œê³µëœ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. 
        - ë§Œì•½ ê´€ë ¨ëœ ë‚´ìš©ì´ ì—†ë‹¤ë©´ ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì„ í†µí•´ ë‹µë³€í•˜ì§€ë§ˆì„¸ìš”.
        (ì˜ˆì‹œ:
            ã€25ë…„ 03ì›” 11ì¼ (í™”)ï½œì£¼ìš” ì¼ì •ã€‘

            ê²½ì œì§€í‘œ

            08:50 - ì¼ë³¸ - 4ë¶„ê¸° ì‹¤ì§ˆGDPì„±ì¥ë¥  â˜…â˜…â˜…
            19:00 - ë¯¸êµ­ - 2ì›” NFIB ì¤‘ì†Œê¸°ì—… ê²½ê¸°ë‚™ê´€ì§€ìˆ˜ â˜…
            23:00 - ë¯¸êµ­ - 1ì›” JOLTS êµ¬ì¸ì¸ì› â˜…â˜…â˜…
            01:00 - ë¯¸êµ­ - EIA ë‹¨ê¸° ì—ë„ˆì§€ì „ë§ë³´ê³ ì„œ â˜…â˜…
            01:00 - ë¯¸êµ­ - USDA ì„¸ê³„ ë†ì‚°ë¬¼ìˆ˜ê¸‰ ì „ë§ë³´ê³ ì„œ â˜…â˜…
            02:00 - ë¯¸êµ­ - 3ë…„ë¬¼ êµ­ì±„ ê²½ë§¤ â˜…â˜…

            -> ë³„í‘œ(â˜…)ê°€ 3ê°œ ì´ìƒì¸ ì¼ì •ë“¤ë§Œ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ê¸°.

            â€¢ 08:50 - ì¼ë³¸ - 4ë¶„ê¸° ì‹¤ì§ˆGDPì„±ì¥ë¥  â˜…â˜…â˜…
            â€¢ 23:00 - ë¯¸êµ­ - 1ì›” JOLTS êµ¬ì¸ì¸ì› â˜…â˜…â˜…
        )

    âš  **ë°˜ë“œì‹œ ì£¼ì–´ì§„ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. ì¶”ê°€ì ì¸ ê°€ì •ì´ë‚˜ ì°½ì‘ì€ í•˜ì§€ ë§ˆì„¸ìš”.**  
    âš  **ì •ë³´ì˜ ì •í™•ì„±ì„ ìœ ì§€í•˜ë©°, ì§€ë‚˜ì¹˜ê²Œ ê·¹ì ì¸ í‘œí˜„ì€ í”¼í•˜ì„¸ìš”.** 
    âš  **ì •ë³´ì˜ ì¶œì²˜ë¥¼ ì ˆëŒ€ ê¸°ì…í•˜ì§€ ë§ˆì„¸ìš”. ì¶œì²˜ì™€ ê´€ë ¨ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤.** 

    " âš  ë³¸ Fingoo ì¦ì‹œ ë ˆí¬íŠ¸ëŠ” ê³µì‹ ë ¥ ìˆëŠ” ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ Fingoo ì¸ê³µì§€ëŠ¥(AI) ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."ë¥¼ ë§ˆì§€ë§‰ì— ì¶œë ¥í•´ì¤˜.

    ìœ„ í¬ë©§ì— ë§ì¶°ì„œ {target_date}ì˜ ì•„ë˜ì˜ contextë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹œí™©ì„ ë§Œë“¤ì–´ì¤˜. 
    contextì— ë‚´ìš©ì´ ì—†ë‹¤ë©´ í¬ë©§ì—ëŠ” ì¡´ì¬í•˜ë”ë¼ë„ ëŒ€ë‹µì—ì„œëŠ” ì œì™¸í•´ì¤˜, Xì™€ HH, MMì€ ë„ˆê°€ ì±„ì›Œì•¼ í•  ë¶€ë¶„ì´ì•¼ í•´ë‹¹ ë¶€ë¶„ì„ ì±„ìš°ì§€ ëª»í•˜ë©´ ë‹µë³€ì—ì„œ ì œì™¸í•´ì¤˜
    context : {full_content}
    """
    return question


def cal_cost(prompt_tokens, completion_tokens):

    # GPT-4o mini ê°€ê²© (USD per 1M tokens)
    input_price = 2.50 / 1_000_000  # ì…ë ¥ í† í°ë‹¹ ë¹„ìš©
    output_price = 10.00 / 1_000_000  # ì¶œë ¥ í† í°ë‹¹ ë¹„ìš©

    # ë¹„ìš© ê³„ì‚°
    input_cost = prompt_tokens * input_price
    output_cost = completion_tokens * output_price
    total_cost = input_cost + output_cost
    return total_cost

def get_response(target_date):
    prompt = prompting(target_date)
    client = OpenAI(api_key="YOUR_OPENAI_API_KEY")
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[
            {"role": "system", "content": "ë‹¹ì‹ ì€ ì£¼ì‹ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì •í™•í•˜ê²Œ ì²˜ë¦¬í•´ì£¼ì„¸ìš”."},
            {"role": "user", "content": prompt}
        ]
    )

    prompt_tokens = response.usage.prompt_tokens
    completion_tokens = response.usage.completion_tokens
    print("Fingoo ì‹œí™© ë ˆí¬íŠ¸ ìƒì„± ì½”ìŠ¤íŠ¸ :", cal_cost(prompt_tokens, completion_tokens))

    return response.choices[0].message.content

if __name__ == "__main__":
    target_date = "2025-04-04"
    report = get_response(target_date)
    print(report)

    # ì„œë²„ì— ì €ì¥
    post_market_report(target_date, report)